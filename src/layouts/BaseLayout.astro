---
interface Props {
  title?: string;
  description?: string;
  showIntro?: boolean;
}

const { 
  title = '艷世設計 YENZ Design | 精雕完美，驚艷世界',
  description = '艷世設計 YENZ Design 是台灣頂尖品牌設計公司，專注品牌識別、視覺設計、網站開發與 VTuber 虛擬形象設計。以匠心獨運的精湛技藝，為您的品牌打造經得起時間考驗的永恆經典。',
  showIntro = false
} = Astro.props;

const currentPath = Astro.url.pathname;
const siteUrl = 'https://yenz.tw';
---

<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{title}</title>
  
  <!-- SEO Meta -->
  <meta name="description" content={description}>
  <meta name="keywords" content="品牌設計, Logo設計, 視覺設計, 網站設計, VTuber設計, LIVE2D, 台北設計公司, 品牌識別, 艷世設計, YENZ">
  <meta name="author" content="艷世設計 YENZ Design Studio">
  <meta name="robots" content="index, follow">
  <link rel="canonical" href={siteUrl + currentPath}>
  
  <!-- Open Graph / Facebook -->
  <meta property="og:type" content="website">
  <meta property="og:url" content={siteUrl + currentPath}>
  <meta property="og:title" content={title}>
  <meta property="og:description" content={description}>
  <meta property="og:image" content={siteUrl + "/images/og-image.webp"}>
  <meta property="og:site_name" content="艷世設計 YENZ Design">
  <meta property="og:locale" content="zh_TW">
  
  <!-- Twitter -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:url" content={siteUrl + currentPath}>
  <meta name="twitter:title" content={title}>
  <meta name="twitter:description" content={description}>
  <meta name="twitter:image" content={siteUrl + "/images/og-image.webp"}>
  
  <!-- Favicon -->
  <link rel="icon" type="image/png" href="/favicon.png">
  <link rel="apple-touch-icon" href="/favicon.png">
  
  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,500&family=Noto+Serif+TC:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Schema.org -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "Organization",
    "name": "艷世設計 YENZ Design",
    "url": "https://yenz.tw",
    "logo": "https://yenz.tw/images/symbol.svg",
    "description": "台灣頂尖品牌設計公司，專注品牌識別、視覺設計、網站開發與虛擬形象設計。",
    "address": {
      "@type": "PostalAddress",
      "addressLocality": "Taipei",
      "addressCountry": "TW"
    }
  }
  </script>
</head>
<body>
  <!-- 星辰碎片滑鼠 -->
  <div class="cursor-glow" id="cursorGlow"></div>
  <div class="cursor-dot" id="cursorDot"></div>
  <div class="reading-bar" id="readingBar"></div>
  <canvas class="orb-canvas" id="orbCanvas"></canvas>
  
  {showIntro && (
    <div id="intro">
      <div class="stars-layer" id="starsLayer"></div>
      <div class="nebula nebula-1"></div>
      <div class="nebula nebula-2"></div>
      
      <div class="intro-deco-circles">
        <div class="intro-circle intro-circle-1"></div>
        <div class="intro-circle intro-circle-2"></div>
        <div class="intro-circle intro-circle-3"></div>
      </div>
      
      <div class="intro-center" id="introCenter">
        <img src="/images/retina-yenz.svg" alt="YENZ" class="intro-logo-img" />
        <div class="intro-line"></div>
        <p class="intro-hint">點擊任意處開始</p>
        <p class="intro-hint-sub">Click anywhere to enter</p>
      </div>
      
      <div class="intro-slogan" id="introSlogan">
        <p class="slogan-zh">精雕完美，驚艷世界。</p>
        <p class="slogan-en">So sophisticated, so perfect.</p>
      </div>
      
      <div class="circle-expand" id="circleExpand"></div>
      <button class="skip-btn" onclick="skipIntro()">SKIP</button>
    </div>
  )}
  
  <div id="main-site" class={showIntro ? '' : 'visible'}>
    <header class="header" id="header">
      <a href="/" class="header-logo">
        <img src="/images/home-yenz.svg" alt="YENZ" class="header-logo-img" />
      </a>
      
      <!-- 漢堡按鈕 -->
      <button class="hamburger" id="hamburger" aria-label="選單">
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
        <span class="hamburger-line"></span>
      </button>
      
      <!-- 桌面導航 -->
      <nav class="header-nav" id="headerNav">
        <a href="/about" class={currentPath === '/about' || currentPath === '/about/' ? 'active' : ''}>ABOUT</a>
        <a href="/services" class={currentPath === '/services' || currentPath === '/services/' ? 'active' : ''}>SERVICES</a>
        <a href="/works" class={currentPath === '/works' || currentPath === '/works/' ? 'active' : ''}>WORKS</a>
        <a href="/process" class={currentPath === '/process' || currentPath === '/process/' ? 'active' : ''}>PROCESS</a>
        <a href="/projects" class={currentPath.startsWith('/projects') ? 'active' : ''}>CSR</a>
        <a href="/contact" class={currentPath === '/contact' || currentPath === '/contact/' ? 'active' : ''}>CONTACT</a>
      </nav>
      
      <!-- 手機選單 -->
      <div class="mobile-menu" id="mobileMenu">
        <nav class="mobile-nav">
          <a href="/" class="mobile-nav-logo">
            <img src="/images/symbol.svg" alt="YENZ" />
          </a>
          <a href="/about" class={currentPath === '/about' || currentPath === '/about/' ? 'active' : ''}>ABOUT</a>
          <a href="/services" class={currentPath === '/services' || currentPath === '/services/' ? 'active' : ''}>SERVICES</a>
          <a href="/works" class={currentPath === '/works' || currentPath === '/works/' ? 'active' : ''}>WORKS</a>
          <a href="/process" class={currentPath === '/process' || currentPath === '/process/' ? 'active' : ''}>PROCESS</a>
          <a href="/projects" class={currentPath.startsWith('/projects') ? 'active' : ''}>CSR</a>
          <a href="/contact" class={currentPath === '/contact' || currentPath === '/contact/' ? 'active' : ''}>CONTACT</a>
        </nav>
        <div class="mobile-menu-footer">
          <p>精雕完美，驚艷世界。</p>
        </div>
      </div>
    </header>
    
    <main>
      <slot />
    </main>
    
    <footer class="footer">
      <div class="footer-grid">
        <div class="footer-brand">
          <div class="footer-logo-wrap">
            <img src="/images/symbol.svg" alt="YENZ" class="footer-symbol" />
            <div class="footer-logo-text">
              <span class="footer-logo">YENZ</span>
              <span class="footer-tagline-zh">精雕完美，驚艷世界。</span>
              <span class="footer-tagline-en">So sophisticated, so perfect.</span>
            </div>
          </div>
          <p class="footer-desc">
            艷世設計以匠心獨運的精湛技藝，為您的品牌打造經得起時間考驗的永恆經典。讓您的品牌在全球市場中綻放獨有的耀眼光芒。
          </p>
        </div>
        <div class="footer-section">
          <h4 class="footer-section-title">NAVIGATION</h4>
          <ul class="footer-links">
            <li><a href="/about">About</a></li>
            <li><a href="/services">Services</a></li>
            <li><a href="/works">Works</a></li>
            <li><a href="/contact">Contact</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4 class="footer-section-title">SERVICES</h4>
          <ul class="footer-links">
            <li><a href="/services#branding">Brand Identity</a></li>
            <li><a href="/services#visual">Visual Design</a></li>
            <li><a href="/services#digital">Digital Experience</a></li>
            <li><a href="/services#virtual">Virtual World</a></li>
          </ul>
        </div>
        <div class="footer-section">
          <h4 class="footer-section-title">CONTACT</h4>
          <ul class="footer-links">
            <li><a href="mailto:yenzdesignstudio@gmail.com">Email</a></li>
            <li><a href="https://lin.ee/aQny7rA" target="_blank">LINE 諮詢</a></li>
            <li>Taipei, Taiwan</li>
          </ul>
        </div>
      </div>
      <div class="footer-bottom">
        <p>© 2016 - 2026 YENZ Design Studio. All Rights Reserved.</p>
        <div class="footer-affiliates">
          Part of YENZ Group:
          <a href="https://thetensy.com" target="_blank">Tensy</a>
          <a href="https://ainomori.tw" target="_blank">Ainomori</a>
        </div>
      </div>
    </footer>
  </div>
  
  <div class="music-player" id="musicPlayer">
    <button class="music-btn" id="musicBtn" onclick="toggleMusic()">
      <svg viewBox="0 0 24 24" id="musicIcon">
        <rect class="bar" x="4" y="10" width="3" height="4" rx="1"/>
        <rect class="bar" x="10" y="7" width="3" height="10" rx="1"/>
        <rect class="bar" x="16" y="10" width="3" height="4" rx="1"/>
      </svg>
    </button>
  </div>
  
  <audio id="bgMusic" loop preload="auto">
    <source src="/audio/ambient.mp3" type="audio/mpeg">
  </audio>
  
  <script is:inline>
    // ====== 漢堡選單 ======
    const hamburger = document.getElementById('hamburger');
    const mobileMenu = document.getElementById('mobileMenu');
    let menuOpen = false;
    
    if (hamburger && mobileMenu) {
      hamburger.addEventListener('click', () => {
        menuOpen = !menuOpen;
        hamburger.classList.toggle('active', menuOpen);
        mobileMenu.classList.toggle('active', menuOpen);
        document.body.style.overflow = menuOpen ? 'hidden' : '';
      });
      
      // 點擊連結後關閉選單
      mobileMenu.querySelectorAll('a').forEach(link => {
        link.addEventListener('click', () => {
          menuOpen = false;
          hamburger.classList.remove('active');
          mobileMenu.classList.remove('active');
          document.body.style.overflow = '';
        });
      });
    }
    
    // ====== 星辰碎片滑鼠效果 ======
    const cursorGlow = document.getElementById('cursorGlow');
    const cursorDot = document.getElementById('cursorDot');
    let mouseX = 0, mouseY = 0;
    let glowX = 0, glowY = 0;
    let stardustParticles = [];
    
    document.addEventListener('mousemove', (e) => {
      mouseX = e.clientX;
      mouseY = e.clientY;
      
      if (Math.random() > 0.5) {
        createStardust(mouseX, mouseY);
      }
    });
    
    function createStardust(x, y) {
      const particle = document.createElement('div');
      particle.className = 'stardust';
      
      const offsetX = (Math.random() - 0.5) * 20;
      const offsetY = (Math.random() - 0.5) * 20;
      
      particle.style.left = (x + offsetX) + 'px';
      particle.style.top = (y + offsetY) + 'px';
      
      const size = 1 + Math.random() * 2;
      particle.style.width = size + 'px';
      particle.style.height = size + 'px';
      
      document.body.appendChild(particle);
      stardustParticles.push({ el: particle, life: 1, vy: -0.5 - Math.random() * 1 });
    }
    
    function animateCursor() {
      glowX += (mouseX - glowX) * 0.12;
      glowY += (mouseY - glowY) * 0.12;
      
      if (cursorGlow) {
        cursorGlow.style.left = glowX + 'px';
        cursorGlow.style.top = glowY + 'px';
      }
      
      if (cursorDot) {
        cursorDot.style.left = mouseX + 'px';
        cursorDot.style.top = mouseY + 'px';
      }
      
      stardustParticles = stardustParticles.filter(p => {
        p.life -= 0.02;
        p.el.style.opacity = String(p.life);
        p.el.style.top = (parseFloat(p.el.style.top) + p.vy) + 'px';
        
        if (p.life <= 0) {
          p.el.remove();
          return false;
        }
        return true;
      });
      
      requestAnimationFrame(animateCursor);
    }
    animateCursor();
    
    document.querySelectorAll('a, button').forEach(el => {
      el.addEventListener('mouseenter', () => {
        if (cursorDot) cursorDot.classList.add('hover');
      });
      el.addEventListener('mouseleave', () => {
        if (cursorDot) cursorDot.classList.remove('hover');
      });
    });
    
    // ====== READING BAR ======
    const readingBar = document.getElementById('readingBar');
    window.addEventListener('scroll', () => {
      const scrollTop = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = (scrollTop / docHeight) * 100;
      if (readingBar) readingBar.style.width = progress + '%';
    });
    
    // ====== HEADER ======
    const header = document.getElementById('header');
    window.addEventListener('scroll', () => {
      if (header) header.classList.toggle('scrolled', window.scrollY > 100);
    });
    
    // ====== ORBS ======
    const orbCanvas = document.getElementById('orbCanvas');
    if (orbCanvas) {
      const oCtx = orbCanvas.getContext('2d');
      let orbs = [];
      
      function resizeOrb() {
        orbCanvas.width = window.innerWidth;
        orbCanvas.height = window.innerHeight;
      }
      
      class Orb {
        constructor() {
          this.x = Math.random() * orbCanvas.width;
          this.y = Math.random() * orbCanvas.height;
          this.size = 80 + Math.random() * 120;
          this.vx = (Math.random() - 0.5) * 0.12;
          this.vy = (Math.random() - 0.5) * 0.12;
          this.pulse = Math.random() * Math.PI * 2;
          this.gold = Math.random() < 0.35;
        }
        update() {
          this.x += this.vx;
          this.y += this.vy;
          this.pulse += 0.006;
          if (this.x < -this.size) this.x = orbCanvas.width + this.size;
          if (this.x > orbCanvas.width + this.size) this.x = -this.size;
          if (this.y < -this.size) this.y = orbCanvas.height + this.size;
          if (this.y > orbCanvas.height + this.size) this.y = -this.size;
        }
        draw() {
          const op = 0.025 + Math.sin(this.pulse) * 0.015;
          const grad = oCtx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.size);
          if (this.gold) {
            grad.addColorStop(0, `rgba(201,169,98,${op * 1.8})`);
            grad.addColorStop(1, 'rgba(201,169,98,0)');
          } else {
            grad.addColorStop(0, `rgba(13,61,46,${op})`);
            grad.addColorStop(1, 'rgba(13,61,46,0)');
          }
          oCtx.fillStyle = grad;
          oCtx.beginPath();
          oCtx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
          oCtx.fill();
        }
      }
      
      function initOrbs() {
        orbs = [];
        for (let i = 0; i < 15; i++) orbs.push(new Orb());
      }
      
      function animateOrbs() {
        oCtx.clearRect(0, 0, orbCanvas.width, orbCanvas.height);
        orbs.forEach(o => { o.update(); o.draw(); });
        requestAnimationFrame(animateOrbs);
      }
      
      window.addEventListener('resize', resizeOrb);
      resizeOrb();
      initOrbs();
      animateOrbs();
    }
    
    // ====== MUSIC ======
    const bgMusic = document.getElementById('bgMusic');
    const musicBtn = document.getElementById('musicBtn');
    let isPlaying = false;
    let musicStarted = false;
    const TARGET_VOLUME = 0.15;
    
    const savedPosition = localStorage.getItem('yenz_music_position');
    const savedPlaying = localStorage.getItem('yenz_music_playing');
    
    if (bgMusic && savedPosition) {
      bgMusic.currentTime = parseFloat(savedPosition);
    }
    
    window.addEventListener('beforeunload', () => {
      if (bgMusic) {
        localStorage.setItem('yenz_music_position', bgMusic.currentTime);
        localStorage.setItem('yenz_music_playing', isPlaying);
      }
    });
    
    if (savedPlaying === 'true' && bgMusic) {
      document.addEventListener('click', function resumeMusic() {
        if (!musicStarted && savedPlaying === 'true') {
          bgMusic.volume = TARGET_VOLUME;
          bgMusic.play().catch(() => {});
          musicStarted = true;
          isPlaying = true;
          if (musicBtn) musicBtn.classList.add('playing');
        }
        document.removeEventListener('click', resumeMusic);
      }, { once: true });
    }
    
    function fadeInMusic() {
      let v = 0;
      const fade = setInterval(() => {
        v += 0.003;
        if (v >= TARGET_VOLUME) {
          v = TARGET_VOLUME;
          clearInterval(fade);
        }
        if (bgMusic) bgMusic.volume = v;
      }, 50);
    }
    
    function toggleMusic() {
      if (!bgMusic) return;
      if (isPlaying) {
        bgMusic.pause();
        if (musicBtn) musicBtn.classList.remove('playing');
      } else {
        if (!musicStarted) {
          bgMusic.volume = 0;
          bgMusic.play().then(() => {
            fadeInMusic();
            musicStarted = true;
          }).catch(() => {});
        } else {
          bgMusic.play();
        }
        if (musicBtn) musicBtn.classList.add('playing');
      }
      isPlaying = !isPlaying;
      localStorage.setItem('yenz_music_playing', isPlaying);
    }
    
    function startMusic() {
      if (!bgMusic || musicStarted) return;
      bgMusic.volume = 0;
      bgMusic.play().then(() => {
        fadeInMusic();
        musicStarted = true;
        isPlaying = true;
        if (musicBtn) musicBtn.classList.add('playing');
        localStorage.setItem('yenz_music_playing', 'true');
      }).catch(() => {});
    }
    
    window.toggleMusic = toggleMusic;
    window.startMusic = startMusic;
    
    // ====== INTRO ======
    const intro = document.getElementById('intro');
    
    if (intro) {
      let introClicked = false;
      let clickX = window.innerWidth / 2;
      let clickY = window.innerHeight / 2;
      
      function createStars() {
        const starsLayer = document.getElementById('starsLayer');
        if (!starsLayer) return;
        for (let i = 0; i < 100; i++) {
          const star = document.createElement('div');
          star.className = 'star';
          star.style.left = Math.random() * 100 + '%';
          star.style.top = Math.random() * 100 + '%';
          star.style.width = (1 + Math.random() * 2) + 'px';
          star.style.height = star.style.width;
          star.style.setProperty('--dur', (2 + Math.random() * 3) + 's');
          star.style.setProperty('--del', Math.random() * 3 + 's');
          starsLayer.appendChild(star);
        }
      }
      createStars();
      
      function createBloom(x, y) {
        for (let i = 0; i < 5; i++) {
          const ring = document.createElement('div');
          ring.className = 'bloom-ring';
          ring.style.left = x + 'px';
          ring.style.top = y + 'px';
          ring.style.transform = 'translate(-50%, -50%)';
          ring.style.animation = `bloomExpand 1.8s ease-out ${i * 0.15}s forwards`;
          intro.appendChild(ring);
        }
      }
      
      intro.addEventListener('click', function(e) {
        if (introClicked || e.target.classList.contains('skip-btn')) return;
        introClicked = true;
        
        clickX = e.clientX;
        clickY = e.clientY;
        
        startMusic();
        createBloom(clickX, clickY);
        
        const introCenter = document.getElementById('introCenter');
        const introSlogan = document.getElementById('introSlogan');
        const circleExpand = document.getElementById('circleExpand');
        const mainSite = document.getElementById('main-site');
        
        if (introCenter) {
          introCenter.style.transition = 'opacity 0.8s ease';
          introCenter.style.opacity = '0';
        }
        
        setTimeout(() => {
          if (introSlogan) {
            introSlogan.style.transition = 'opacity 1.5s ease';
            introSlogan.style.opacity = '1';
          }
        }, 600);
        
        setTimeout(() => {
          if (introSlogan) {
            introSlogan.style.transition = 'opacity 0.8s ease';
            introSlogan.style.opacity = '0';
          }
          
          if (circleExpand) {
            circleExpand.style.left = clickX + 'px';
            circleExpand.style.top = clickY + 'px';
            circleExpand.style.transform = 'translate(-50%, -50%)';
            circleExpand.style.opacity = '1';
            circleExpand.style.transition = 'width 2s cubic-bezier(0.4,0,0.2,1), height 2s cubic-bezier(0.4,0,0.2,1)';
            
            setTimeout(() => {
              const max = Math.max(window.innerWidth, window.innerHeight) * 3;
              circleExpand.style.width = max + 'px';
              circleExpand.style.height = max + 'px';
            }, 50);
          }
        }, 4500);
        
        setTimeout(() => {
          intro.style.transition = 'opacity 0.5s ease';
          intro.style.opacity = '0';
          if (mainSite) {
            mainSite.classList.add('visible');
            mainSite.style.opacity = '1';
          }
        }, 6000);
        
        setTimeout(() => {
          intro.style.display = 'none';
        }, 6500);
      });
    }
    
    window.skipIntro = function() {
      const intro = document.getElementById('intro');
      const mainSite = document.getElementById('main-site');
      if (intro) {
        intro.style.transition = 'opacity 0.4s ease';
        intro.style.opacity = '0';
        setTimeout(() => {
          intro.style.display = 'none';
          if (mainSite) {
            mainSite.classList.add('visible');
            mainSite.style.opacity = '1';
          }
        }, 400);
      }
      startMusic();
    };
    
    // ====== REVEAL ======
    const revealElements = document.querySelectorAll('.reveal');
    const revealObserver = new IntersectionObserver((entries) => {
      entries.forEach(entry => {
        if (entry.isIntersecting) entry.target.classList.add('visible');
      });
    }, { threshold: 0.1 });
    revealElements.forEach(el => revealObserver.observe(el));
    
    // ====== CARD PARTICLES ======
    document.querySelectorAll('.service-card').forEach(card => {
      const particleContainer = document.createElement('div');
      particleContainer.className = 'card-particles';
      particleContainer.style.cssText = 'position:absolute;top:0;left:0;width:100%;height:100%;pointer-events:none;overflow:hidden;';
      card.appendChild(particleContainer);
      
      card.addEventListener('mouseenter', () => {
        for (let i = 0; i < 12; i++) {
          setTimeout(() => {
            const p = document.createElement('div');
            p.style.cssText = `position:absolute;width:4px;height:4px;background:#C9A962;border-radius:50%;left:${Math.random()*100}%;bottom:0;opacity:0;animation:particleFly 1.5s ease-out forwards;`;
            particleContainer.appendChild(p);
            setTimeout(() => p.remove(), 1500);
          }, i * 50);
        }
      });
    });
    
    if (!document.getElementById('particleStyle')) {
      const style = document.createElement('style');
      style.id = 'particleStyle';
      style.textContent = `@keyframes particleFly { 0% { opacity:0; transform:translateY(0) scale(0); } 20% { opacity:0.8; } 100% { opacity:0; transform:translateY(-150px) scale(1); } }`;
      document.head.appendChild(style);
    }
  </script>
  
  <style is:global>
    @import '/src/styles/global.css';
  </style>
</body>
</html>
